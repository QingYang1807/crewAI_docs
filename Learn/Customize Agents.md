# 自定义代理

> 一份全面指南，介绍如何在CrewAI框架内为特定角色、任务和高级定制需求调整代理。

## 可自定义属性

打造一个高效的CrewAI团队，关键在于能够动态调整AI代理，以满足任何项目的独特需求。本节介绍了您可以自定义的基础属性。

### 可自定义的关键属性

| 属性 | 描述 |
| :---------------------------------- | :------------------------------------------------------------------------------------------------------------------ |
| **角色** | 指定代理在团队中的工作，如"分析师"或"客户服务代表"。 |
| **目标** | 定义代理的目标，与其角色和团队的整体使命保持一致。 |
| **背景故事** | 为代理的角色提供深度，增强其在团队内的动机和参与度。 |
| **工具** *(可选)* | 表示代理用于任务的能力或方法，从简单功能到复杂集成。 |
| **缓存** *(可选)* | 决定代理是否应使用缓存来使用工具。 |
| **最大每分钟请求数** | 设置每分钟最大请求数(`max_rpm`)。可以设置为`None`以对外部服务进行无限制请求。 |
| **详细模式** *(可选)* | 启用详细日志记录用于调试和优化，提供执行过程的洞察。 |
| **允许委托** *(可选)* | 控制任务委托给其他代理，默认为`False`。 |
| **最大迭代次数** *(可选)* | 限制任务的最大迭代次数(`max_iter`)以防止无限循环，默认为25。 |
| **最大执行时间** *(可选)* | 设置代理完成任务所允许的最大时间。 |
| **系统模板** *(可选)* | 定义代理的系统格式。 |
| **提示模板** *(可选)* | 定义代理的提示格式。 |
| **响应模板** *(可选)* | 定义代理的响应格式。 |
| **使用系统提示** *(可选)* | 控制代理是否在任务执行期间使用系统提示。 |
| **尊重上下文窗口** | 默认启用滑动上下文窗口，保持上下文大小。 |
| **最大重试限制** | 设置代理在出错时的最大重试次数(`max_retry_limit`)。 |

## 高级定制选项

除了基本属性外，CrewAI还允许进行更深层次的定制，以显著增强代理的行为和能力。

### 语言模型定制

代理可以使用特定的语言模型(`llm`)和函数调用语言模型(`function_calling_llm`)进行定制，为其处理和决策能力提供高级控制。
需要注意的是，设置`function_calling_llm`可以覆盖默认的团队函数调用语言模型，提供更大程度的定制化。

## 性能和调试设置

调整代理的性能并监控其操作对于高效的任务执行至关重要。

### 详细模式和RPM限制

* **详细模式**：启用代理操作的详细日志记录，对调试和优化非常有用。具体而言，它提供代理执行过程的洞察，有助于性能优化。
* **RPM限制**：设置每分钟最大请求数(`max_rpm`)。此属性是可选的，可以设置为`None`表示无限制，如果需要，允许对外部服务进行无限查询。

### 任务执行的最大迭代次数

`max_iter`属性允许用户定义代理对单个任务可以执行的最大迭代次数，防止无限循环或过长的执行。
默认值设置为25，在彻底性和效率之间提供了平衡。当代理接近这个数字时，它会尽力给出一个好的答案。

## 定制代理和工具

代理通过在初始化过程中定义其属性和工具来进行定制。工具对代理的功能至关重要，使其能够执行专门任务。
`tools`属性应该是代理可以利用的工具数组，默认初始化为空列表。可以在代理初始化后添加或修改工具以适应新需求。

```shell  theme={null}
pip install 'crewai[tools]'
```

### 示例：为代理分配工具

```python Code theme={null}
import os
from crewai import Agent
from crewai_tools import SerperDevTool

# 设置工具初始化的API密钥
os.environ["OPENAI_API_KEY"] = "您的密钥"
os.environ["SERPER_API_KEY"] = "您的密钥"

# 初始化搜索工具
search_tool = SerperDevTool()

# 使用高级选项初始化代理
agent = Agent(
  role='研究分析师',
  goal='提供最新的市场分析',
  backstory='一位具有敏锐市场趋势洞察力的专家分析师。',
  tools=[search_tool],
  memory=True, # 启用记忆
  verbose=True,
  max_rpm=None, # 对每分钟请求数无限制
  max_iter=25, # 最大迭代次数的默认值
)
```

## 委托和自主性

控制代理委托任务或提问的能力对于在CrewAI框架内调整其自主性和协作动态至关重要。默认情况下，
`allow_delegation`属性现在设置为`False`，禁用代理寻求帮助或委托任务的功能。可以更改此默认行为以促进CrewAI生态系统内的协作解决问题和提高效率。
如果需要，可以启用委托以适应特定的操作要求。

### 示例：为代理禁用委托

```python Code theme={null}
agent = Agent(
  role='内容撰写者',
  goal='撰写有关市场趋势的引人入胜的内容',
  backstory='一位具有市场分析专业知识的经验丰富的作家。',
  allow_delegation=True # 启用委托
)
```

## 结论

通过设置代理的角色、目标、背景故事和工具，以及语言模型定制、记忆、性能设置和委托偏好等高级选项来定制CreadyAI中的代理，
为一个精细且能够应对复杂挑战的AI团队做好准备。